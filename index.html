<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- El título se establecerá con JavaScript -->
    <title>Agente de Empleo con IA</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga de la fuente Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Carga de Marked.js para renderizar Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilos para el scrollbar del chat */
        #chat-window::-webkit-scrollbar { width: 8px; }
        #chat-window::-webkit-scrollbar-track { background: #1f2937; }
        #chat-window::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        #chat-window::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        /* Animación del loader */
        .loader {
            border-top-color: #3498db;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Estilos para el contenido Markdown del agente */
        .agent-bubble p { margin-bottom: 0.5rem; }
        .agent-bubble p:last-child { margin-bottom: 0; }
        .agent-bubble ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-top: 0.75rem;
            margin-bottom: 0.75rem;
            padding-left: 0.5rem;
        }
        .agent-bubble li { margin-bottom: 0.25rem; }
        .agent-bubble strong { 
            font-weight: 600; 
            color: #dbeafe; /* Un azul claro para resaltar */
        }
        .user-bubble p { margin: 0; }
        
        /* Estilos para botones de idioma */
        .lang-btn {
            background-color: #374151; /* bg-gray-700 */
            color: #d1d5db; /* text-gray-300 */
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem; /* rounded-md */
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            transition: all 0.2s;
        }
        .lang-btn.active {
            background-color: #3b82f6; /* bg-blue-600 */
            color: #ffffff; /* text-white */
        }
        .lang-btn:not(.active):hover {
            background-color: #4b5563; /* bg-gray-600 */
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

    <div class="container relative mx-auto max-w-7xl h-[85vh] bg-gray-800 rounded-lg shadow-2xl flex flex-col md:flex-row overflow-hidden">

        <!-- Selector de Idioma -->
        <div class="absolute top-3 right-5 z-10 flex space-x-2">
            <button id="lang-btn-es" class="lang-btn" data-lang="es">ES</button>
            <button id="lang-btn-en" class="lang-btn" data-lang="en">EN</button>
        </div>

        <!-- Columna Izquierda: CV -->
        <div class="md:w-1/3 h-full flex flex-col p-4 border-r border-gray-700">
            <h2 class="text-xl font-bold mb-4 text-center" data-i18n-key="cvTitle">Tu Curriculum Vitae (CV)</h2>
            <p class="text-sm text-gray-400 mb-3" data-i18n-key="cvSubtitle">Pega tu CV aquí. El agente lo usará para encontrar las mejores ofertas.</p>
            <textarea id="cv-textarea" class="w-full h-full p-3 bg-gray-900 border border-gray-700 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500" data-i18n-key="cvPlaceholder" data-i18n-type="placeholder" placeholder="Pega tu CV completo aquí..."></textarea>
            <button id="load-cv-btn" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300" data-i18n-key="analyzeBtn">
                Analizar CV y Buscar Empleos
            </button>
        </div>

        <!-- Columna Derecha: Chat y Resultados -->
        <div class="md:w-2/3 h-full flex flex-col">
            
            <!-- Ventana de Chat -->
            <div id="chat-window" class="flex-1 p-4 overflow-y-auto space-y-4">
                <!-- El mensaje de bienvenida se añade con JS -->
            </div>

            <!-- Loader -->
            <div id="loader" class="hidden flex items-center justify-center p-2">
                <div class="loader w-6 h-6 border-4 border-gray-600 rounded-full"></div>
                <span class="ml-3 text-sm text-gray-400" data-i18n-key="loaderMsg">El agente está pensando...</span>
            </div>
            
            <!-- Contenedor de Empleos Encontrados -->
            <div id="job-listings-container" class="hidden p-4 border-t border-gray-700 bg-gray-900/50">
                <h3 class="text-lg font-semibold mb-2" data-i18n-key="jobsFoundTitle">Empleos Encontrados</h3>
                <div id="job-listings" class="max-h-32 overflow-y-auto space-y-2 pr-2">
                    <!-- Los empleos se listarán aquí -->
                </div>
            </div>

            <!-- Input del Usuario -->
            <form id="user-input-form" class="p-4 border-t border-gray-700">
                <div class="flex space-x-3">
                    <input type="text" id="user-input" class="flex-1 p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" data-i18n-key="chatPlaceholder" data-i18n-type="placeholder" placeholder="Responde al agente aquí..." disabled>
                    <button type="submit" id="send-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 disabled:opacity-50" data-i18n-key="sendBtn" disabled>
                        Enviar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        // --- Referencias del DOM ---
        const cvTextarea = document.getElementById('cv-textarea');
        const loadCvBtn = document.getElementById('load-cv-btn');
        const chatWindow = document.getElementById('chat-window');
        const userInputForm = document.getElementById('user-input-form');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const loader = document.getElementById('loader');
        const jobListingsContainer = document.getElementById('job-listings-container');
        const jobListings = document.getElementById('job-listings');
        const langBtnEs = document.getElementById('lang-btn-es');
        const langBtnEn = document.getElementById('lang-btn-en');

        // --- Estado de la Aplicación ---
        let chatHistory = [];
        let cvText = "";
        let isAgentReady = false;
        let currentLang = 'es'; // Idioma por defecto

        // --- Configuración de la API de Gemini ---
        const apiKey = ""; // Deja esto como está, Canvas lo gestionará
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // --- Diccionario de Textos (i18n) ---
        const uiStrings = {
            es: {
                title: "Agente de Empleo con IA",
                cvTitle: "Tu Curriculum Vitae (CV)",
                cvSubtitle: "Pega tu CV aquí. El agente lo usará para encontrar las mejores ofertas.",
                cvPlaceholder: "Pega tu CV completo aquí... (Ej: Juan Pérez, Desarrollador Web, Experiencia en JavaScript, Educación...)",
                analyzeBtn: "Analizar CV y Buscar Empleos",
                welcomeMsg: "¡Hola! Soy tu agente de IA para búsqueda de empleo. Pega tu CV a la izquierda y presiona el botón para comenzar.",
                loaderMsg: "El agente está pensando...",
                jobsFoundTitle: "Empleos Encontrados",
                noJobsFound: "No se encontraron empleos esta vez.",
                untitledLink: "Enlace sin título",
                chatPlaceholder: "Responde al agente aquí...",
                sendBtn: "Enviar",
                cvTooShort: "Por favor, pega un CV más completo (mínimo 50 caracteres) para que pueda analizarlo correctamente.",
                cvReceived: "¡CV recibido! Analizándolo y buscando empleos relevantes en internet. Esto puede tardar un momento...",
                firstMessageCV: "Este es mi CV:\n\n---\n{cv}\n---\n\nPor favor, analiza mi CV, busca empleos relevantes y dime qué encuentras y qué habilidades clave podrían faltarme según las ofertas.",
                apiError: "Lo siento, he encontrado un error al procesar tu solicitud. Inténtalo de nuevo.",
                connectionError: "He tenido un problema de conexión. Por favor, espera un momento y vuelve a intentarlo.",
                systemPrompt: `
Eres un "Agente de IA" experto en reclutamiento y análisis de perfiles. Tu tono es profesional, proactivo y servicial.
Tu tarea es ayudar al usuario a encontrar las mejores ofertas de trabajo basadas en su CV y en la conversación.

**Tu Proceso Obligatorio (Debes seguirlo en cada respuesta):**

1.  **Analizar Contexto:** Revisa el CV del usuario (proporcionado en el primer mensaje) y TODO el historial de chat para entender sus habilidades, experiencia y las habilidades nuevas que ha confirmado.
2.  **Buscar Empleos:** Utiliza SIEMPRE tu herramienta de Google Search para encontrar ofertas de trabajo relevantes en tiempo real basadas en el análisis del contexto.
3.  **Análisis de Brechas (Gap Analysis):** Compara las 3-5 ofertas de trabajo más relevantes que encontraste con las habilidades del CV del usuario Y las habilidades confirmadas en el chat.
4.  **Preguntar (Clave):** Si identificas habilidades CLAVE en las descripciones de los trabajos que NO están ni en el CV ni han sido confirmadas en el chat, DEBES preguntarle al usuario sobre ellas. Sé específico.
    * *Ejemplo Malo:* "¿Tienes otras habilidades?"
    * *Ejemplo Bueno:* "He notado que varias ofertas para 'Desarrollador Senior' piden experiencia con 'Kubernetes' y 'CI/CD'. ¿Tienes experiencia en estas áreas?"
5.  **Confirmar y Sugerir Actualización:** Si el usuario confirma una nueva habilidad (ej. "Sí, usé Kubernetes por 2 años"), primero confirma que la has "anotado" para futuras búsquedas. Segundo, DEBES sugerirle que actualice su CV en el editor de texto.
    * *Ejemplo:* "¡Excelente! He tomado nota de tu experiencia con 'Kubernetes'. Te recomiendo añadirlo a tu CV en el editor de la izquierda para que los reclutadores puedan verlo."
6.  **Responder:** Formula una respuesta conversacional que incluya:
    a) Un resumen de los empleos encontrados.
    b) Tus preguntas sobre las habilidades faltantes (el "Gap Analysis").
    c) Respuestas a cualquier pregunta directa que el usuario haya hecho.
    
**Mandatorio:** DEBES basar tu resumen de empleos y tu análisis de brechas (Gap Analysis) *directamente* en los resultados de la Búsqueda de Google.

**Regla Crítica para Enlaces:** Tu respuesta DEBE estar *directamente* basada en la información de los resultados de la búsqueda. Si no basas tu respuesta en los resultados de búsqueda, los enlaces de "Empleos Encontrados" (las URLs de las vacantes) NO aparecerán, y fallarás en tu tarea principal. El usuario NECESITA esos enlaces para poder aplicar.

**Regla de Formato de Enlaces (NUEVO):** Al final de tu resumen de empleos, DEBES incluir una lista de los 3-5 enlaces de vacantes más relevantes en formato Markdown, de esta forma:
* [Título del Empleo 1](httpsURL-real-de-la-vacante.com)
* [Título del Empleo 2](httpsURL-real-de-la-vacante.net)

**Formato de Respuesta:** Utiliza Markdown para formatear tu respuesta. Usa listas con viñetas (\`*\`) para preguntas o puntos clave, y \`**negrita**\` para resaltar habilidades o títulos de trabajo. Esto es crucial para la legibilidad.
`
            },
            en: {
                title: "AI Job Agent",
                cvTitle: "Your Curriculum Vitae (CV)",
                cvSubtitle: "Paste your CV here. The agent will use it to find the best opportunities.",
                cvPlaceholder: "Paste your full CV here... (e.g., John Doe, Web Developer, JavaScript Experience, Education...)",
                analyzeBtn: "Analyze CV and Search Jobs",
                welcomeMsg: "Hi! I'm your AI job agent. Paste your CV on the left and press the button to start.",
                loaderMsg: "The agent is thinking...",
                jobsFoundTitle: "Jobs Found",
                noJobsFound: "No jobs were found this time.",
                untitledLink: "Untitled Link",
                chatPlaceholder: "Reply to the agent here...",
                sendBtn: "Send",
                cvTooShort: "Please paste a more complete CV (minimum 50 characters) so I can analyze it correctly.",
                cvReceived: "CV received! Analyzing it and searching for relevant jobs online. This may take a moment...",
                firstMessageCV: "This is my CV:\n\n---\n{cv}\n---\n\nPlease analyze my CV, search for relevant jobs, and tell me what you find and what key skills I might be missing based on the listings.",
                apiError: "Sorry, I've encountered an error while processing your request. Please try again.",
                connectionError: "I've had a connection issue. Please wait a moment and try again.",
                systemPrompt: `
You are an expert AI Agent specializing in recruitment and profile analysis. Your tone is professional, proactive, and helpful.
Your task is to help the user find the best job offers based on their CV and the conversation.

**Your Mandatory Process (You must follow this on every reply):**

1.  **Analyze Context:** Review the user's CV (provided in the first message) and ALL chat history to understand their skills, experience, and any new skills they have confirmed.
2.  **Search Jobs:** ALWAYS use your Google Search tool to find relevant job openings in real-time based on the context analysis.
3.  **Gap Analysis:** Compare the 3-5 most relevant job openings you found with the user's CV skills AND the skills confirmed in the chat.
4.  **Ask (Key):** If you identify KEY skills in the job descriptions that are NOT in the CV and have NOT been confirmed in the chat, you MUST ask the user about them. Be specific.
    * *Bad Example:* "Do you have other skills?"
    * *Good Example:* "I noticed several listings for 'Senior Developer' require experience with 'Kubernetes' and 'CI/CD'. Do you have experience in these areas?"
5.  **Confirm and Suggest Update:** If the user confirms a new skill (e.g., "Yes, I used Kubernetes for 2 years"), first confirm you have "noted" it for future searches. Second, you MUST suggest they update their CV in the text editor.
    * *Example:* "Excellent! I've noted your experience with 'Kubernetes'. I recommend adding that to your CV in the editor on the left so recruiters can see it."
6.  **Reply:** Formulate a conversational response that includes:
    a) A summary of the jobs found.
    b) Your questions about missing skills (the "Gap Analysis").
    c) Answers to any direct questions the user asked.
    
**Mandatory:** You MUST base your job summary and Gap Analysis *directly* on the Google Search results.

**Critical Link Rule:** Your response MUST be *directly* based on information from the search results. If you don't base your reply on the search results, the "Jobs Found" links (the job posting URLs) will NOT appear, and you will fail your primary task. The user NEEDS those links to apply.

**Link Format Rule (NEW):** At the end of your job summary, you MUST include a list of the 3-5 most relevant job links in Markdown format, like this:
* [Job Title 1](https://real-job-url.com)
* [Job Title 2](https://real-job-url.net)

**Response Format:** Use Markdown to format your response. Use bulleted lists (\`*\`) for questions or key points, and \`**bold**\` to highlight skills or job titles. This is crucial for readability.
`
            }
        };

        // --- Event Listeners ---

        // Cambiar idioma
        langBtnEs.addEventListener('click', () => setLanguage('es'));
        langBtnEn.addEventListener('click', () => setLanguage('en'));

        // Cargar CV e iniciar el agente
        loadCvBtn.addEventListener('click', () => {
            cvText = cvTextarea.value;
            if (cvText.trim().length < 50) {
                addMessage('agent', uiStrings[currentLang].cvTooShort);
                return;
            }

            // Reiniciar la UI y el historial
            resetChat();
            addMessage('user', `CV Loaded: ${cvText.substring(0, 150)}... [CV remainder hidden for brevity]`);
            addMessage('agent', uiStrings[currentLang].cvReceived);
            
            userInput.disabled = true;
            sendBtn.disabled = true;
            isAgentReady = false;

            // El primer mensaje al agente incluye el CV completo
            const firstMessage = uiStrings[currentLang].firstMessageCV.replace('{cv}', cvText);
            runAgent(firstMessage);
        });

        // Enviar mensaje del usuario
        userInputForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const userMessage = userInput.value.trim();
            if (userMessage && isAgentReady) {
                addMessage('user', userMessage);
                userInput.value = '';
                userInput.disabled = true;
                sendBtn.disabled = true;
                isAgentReady = false;
                
                runAgent(userMessage);
            }
        });

        // --- Funciones Principales ---

        /**
         * Ejecuta el agente de IA llamando a la API de Gemini.
         * @param {string} userMessage - El mensaje del usuario para este turno.
         */
        async function runAgent(userMessage) {
            showLoader(true);

            // 1. Construir el historial de 'contents'
            const contents = [
                ...chatHistory,
                {
                    role: "user",
                    parts: [{ text: userMessage }]
                }
            ];
            
            // 2. Obtener el systemPrompt en el idioma actual
            const systemPrompt = uiStrings[currentLang].systemPrompt;

            // 3. Definir el Payload para la API
            const payload = {
                contents: contents,
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
                tools: [
                    { "google_search": {} } // Habilitar la búsqueda de Google
                ]
            };

            // 4. Llamar a la API con reintentos (backoff)
            try {
                const response = await fetchWithBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`Error de API: ${response.statusText}`);
                }

                const result = await response.json();
                
                // 5. Procesar la respuesta
                const candidate = result.candidates?.[0];
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const agentResponseText = candidate.content.parts[0].text;
                    const groundingMetadata = candidate.groundingMetadata;

                    // 6. Actualizar el historial de chat
                    chatHistory.push({ role: "user", parts: [{ text: userMessage }] });
                    chatHistory.push({ role: "model", parts: [{ text: agentResponseText }] });

                    // 7. Mostrar la respuesta del agente
                    addMessage('agent', agentResponseText);

                    // 8. Mostrar los empleos (¡Lógica mejorada!)
                    const combinedSources = [];
                    const addedUris = new Set();

                    // Método 1: Desde las "fuentes" (GroundingMetadata)
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        groundingMetadata.groundingAttributions
                            .map(attr => attr.web)
                            .filter(web => web && web.uri && web.title)
                            .forEach(source => {
                                if (!addedUris.has(source.uri)) {
                                    combinedSources.push({ uri: source.uri, title: source.title });
                                    addedUris.add(source.uri);
                                }
                            });
                    }

                    // Método 2: Extraer enlaces Markdown de la respuesta del agente (¡Nuevo!)
                    const markdownLinks = extractMarkdownLinks(agentResponseText);
                    markdownLinks.forEach(link => {
                        if (!addedUris.has(link.uri)) {
                            combinedSources.push(link);
                            addedUris.add(link.uri);
                        }
                    });

                    // Mostrar todos los empleos encontrados
                    displayJobs(combinedSources);

                } else {
                    console.error("Respuesta inesperada de la API:", result);
                    addMessage('agent', uiStrings[currentLang].apiError);
                }

            } catch (error) {
                console.error("Error al llamar a runAgent:", error);
                addMessage('agent', uiStrings[currentLang].connectionError);
            } finally {
                // 9. Reactivar la UI
                showLoader(false);
                userInput.disabled = false;
                sendBtn.disabled = false;
                isAgentReady = true;
                userInput.focus();
            }
        }
        
        /**
         * Cambia el idioma de la UI y reinicia el chat.
         * @param {'es' | 'en'} lang - El idioma a establecer.
         */
        function setLanguage(lang) {
            if (lang !== currentLang) {
                currentLang = lang;
                // Reinicia el chat al cambiar de idioma
                resetChat();
            }

            // Actualizar botones
            langBtnEs.classList.toggle('active', lang === 'es');
            langBtnEn.classList.toggle('active', lang === 'en');
            
            // Actualizar título de la página
            document.title = uiStrings[lang].title;

            // Actualizar todos los elementos de la UI con data-attributes
            document.querySelectorAll('[data-i18n-key]').forEach(el => {
                const key = el.getAttribute('data-i18n-key');
                const type = el.getAttribute('data-i18n-type');
                
                if (key && uiStrings[lang][key]) {
                    if (type === 'placeholder') {
                        el.placeholder = uiStrings[lang][key];
                    } else {
                        el.textContent = uiStrings[lang][key];
                    }
                }
            });
        }
        
        /**
         * Reinicia el chat a su estado inicial.
         */
        function resetChat() {
            chatHistory = [];
            cvText = "";
            isAgentReady = false;
            chatWindow.innerHTML = '';
            jobListings.innerHTML = '';
            jobListingsContainer.classList.add('hidden');
            userInput.disabled = true;
            sendBtn.disabled = true;
            loadCvBtn.disabled = false;
            cvTextarea.disabled = false;
            // Añadir mensaje de bienvenida en el idioma actual
            addMessage('agent', uiStrings[currentLang].welcomeMsg);
        }

        /**
         * Añade un mensaje a la ventana del chat.
         * @param {'user' | 'agent'} sender - Quién envía el mensaje.
         * @param {string} text - El contenido del mensaje.
         */
        function addMessage(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
            
            const textContainer = document.createElement('div');
            textContainer.className = `max-w-xs lg:max-w-lg p-3 rounded-lg shadow text-sm ${sender === 'user' ? 'bg-blue-600 user-bubble' : 'bg-gray-700 agent-bubble'}`;

            if (sender === 'agent') {
                textContainer.innerHTML = marked.parse(text);
            } else {
                const sanitizedText = text
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/\n/g, '<br>');
                textContainer.innerHTML = `<p>${sanitizedText}</p>`;
            }

            messageDiv.appendChild(textContainer);
            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight; // Auto-scroll
        }

        /**
         * Extrae enlaces Markdown de un texto.
         * @param {string} text - El texto del agente.
         * @returns {Array<{uri: string, title: string}>}
         */
        function extractMarkdownLinks(text) {
            const links = [];
            const regex = /\[([^\]]+)\]\((https?:\/\/[^\)]+)\)/g;
            let match;
            while ((match = regex.exec(text)) !== null) {
                links.push({
                    title: match[1],
                    uri: match[2]
                });
            }
            return links;
        }

        /**
         * Muestra los trabajos encontrados en su contenedor.
         * @param {Array<{uri: string, title: string}>} sources - Las fuentes de la búsqueda.
         */
        function displayJobs(sources) {
            jobListings.innerHTML = ''; // Limpiar empleos anteriores
            if (!sources || sources.length === 0) {
                jobListings.innerHTML = `<p class="text-sm text-gray-400">${uiStrings[currentLang].noJobsFound}</p>`;
                jobListingsContainer.classList.remove('hidden');
                return;
            }

            sources.forEach(source => {
                const jobLink = document.createElement('a');
                jobLink.href = source.uri;
                jobLink.target = '_blank';
                jobLink.rel = 'noopener noreferrer';
                jobLink.className = 'flex items-center justify-between p-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition duration-200 group';
                
                const titleSpan = document.createElement('span');
                titleSpan.className = 'truncate';
                titleSpan.textContent = source.title || uiStrings[currentLang].untitledLink;
                
                const iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 group-hover:text-white shrink-0 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>`;
                
                jobLink.appendChild(titleSpan);
                jobLink.innerHTML += iconSvg;
                
                jobListings.appendChild(jobLink);
            });
            jobListingsContainer.classList.remove('hidden');
        }

        /**
         * Muestra u oculta el indicador de carga.
         * @param {boolean} show - True para mostrar, false para ocultar.
         */
        function showLoader(show) {
            loader.classList.toggle('hidden', !show);
        }

        /**
         * Función fetch con reintento y backoff exponencial.
         * @param {string} url - La URL de la API.
         * @param {object} options - Las opciones de fetch.
         * @param {number} maxRetries - Número máximo de reintentos.
         */
        async function fetchWithBackoff(url, options, maxRetries = 3) {
            let attempt = 0;
            while (attempt < maxRetries) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 || response.status >= 500) {
                        throw new Error(`Server error: ${response.status}`);
                    }
                    return response; // Éxito
                } catch (error) {
                    attempt++;
                    if (attempt >= maxRetries) {
                        throw error;
                    }
                    const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }
        
        // --- Inicialización ---
        setLanguage(currentLang); // Establecer el idioma inicial (español)

    </script>
</body>
</html>

